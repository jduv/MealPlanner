<!DOCTYPE html>
<html>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<head>
		<title>Meal Planner</title>
		<link rel="stylesheet" type="text/css" href="css/jquery-mobile-custom-structure-1.3.1.min.css" />
		<link rel="stylesheet" type="text/css" href="css/jquery-mobile-custom-theme-1.3.1.min.css" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap-2.3.1.min.css" />
		<link rel="stylesheet" type="text/css" href="css/font-awesome-3.0.0.min.css" />
		<link rel="stylesheet" type="text/css" href="css/mealplanner-0.0.1.css" />
	</head>
	<body>
		<div data-role="page">
			<div class="header">
				<h1 class="text-center">
					<i class="icon-food icon-border"></i> Meal Planner</h1>
			</div>

			<div id="app">
			</div>

			<div class="navbar navbar-fixed-bottom">
				<div class="navbar-inner">
					<ul class="nav">
						<li id="nav-recipes"><a href="#recipes"><i class="icon-briefcase"></i> Recipe box</a></li>
						<li id="nav-planner"><a href="#planner"><i class="icon-calendar"></i> Daily planner</a></li>
					</ul>
				</div>
			</div>
		</div>

		<!-- Script includes -->
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/jquery-migrate-1.1.1.min.js"></script>
		<script src="js/jquery-mobile-custom-1.3.1.min.js"></script>
		<script src="js/icanhaz-0.10.2.min.js"></script>
		<script src="js/sammy-0.7.4.min.js"></script>
		<script src="js/bootstrap-2.3.1.min.js"></script>
		<script src="js/mealplanner-0.0.1.js"></script>
		<script>

			// Run!
			$(document).ready(function () {
				loadTemplates(runApp);

				$('.nav li a').click(function()
					{
					  $('.nav li').removeClass('active');
					  $(this).parent().addClass('active');
					});
			});

			// Loads templates.
			function loadTemplates(success)
			{
				$.get("./tpl/templates.html")
				 .done(function(data) {
						// Append templates to the end of the body tag
						$("head").append(data);

						// Reboot ICH, removes loaded templates from DOM once built.
						ich.grabTemplates();
						success();
					})
				 .fail(function() {
				 	$("#app").append("Error loading templates!");
				 });
			}

			// Runs the app. Call after templates are loaded.
			function runApp()
			{
				// Add main sammy route
				var app = $.sammy("#app", function() {
					// Make transitions purdy.
					this.swap = function(content, callback) {
						var context = this;
				     	context.$element().fadeOut('fast', function() {
				       	context.$element().html(content);
				       	context.$element().fadeIn('fast', function() {
				       		if (callback) {
				       			callback.apply();
				       		}
				       	});
				       });
				     };

					this.get("#recipes", function(context) {
						context.app.swap(ich.recipes());
						$("#nav-recipes").addClass("active");
						$("#nav-planner").removeClass("active");
					});

					this.get("#planner", function(context) {
						context.app.swap(ich.planner());
						$("#nav-planner").addClass("active");
						$("#nav-recipes").removeClass("active");
					})
				});

				// Run the application
				app.run("#recipes");
			}
		</script>
	</body>
</html>